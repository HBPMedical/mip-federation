Install Ansible

apt install python-setuptools -y
easy_install pip
pip install ansible

H
sudo apt-get install python-pip
pip install ansible


all nodes should have python installed
sudo apt-get install python

Step 1)
Change: ansible_host,hostname,local_path from hosts.ini
Change: REMOTE_USER,BECOME_USER,CHDIR (the path to mip-federation folder in your manager remote node),PORTAINER_DATA
(the path to portainer folder in your manager remote node)
METADATA_PATH the path to your local host where variablesMetadata.json exists

run :
For every node to get the metadata file. You can run this playbook again when changes occur so every node to get the changes
ansible-playbook -i hosts.ini metadata.yaml -c paramiko --ask-pass --ask-become-pass  -vvvv

ansible-playbook -i hosts.ini docker-deploy.yaml -c paramiko --ask-pass --ask-become-pass  -vvvv
ansible-playbook -i hosts.ini docker-start-services.yaml -c paramiko --ask-pass --ask-become-pass -vvvv
if you do not want to start portainer service you must exclude tag portainer:
ansible-playbook -i hosts.ini docker-start-services.yaml -c paramiko --ask-pass --ask-become-pass --skip-tags portainer -vvvv

stop:
ansible-playbook -i hosts.ini docker-stop-services.yaml -c paramiko --ask-pass --ask-become-pass  -vvvv
If you only want to stop portainer you can do so by:
ansible-playbook -i hosts.ini docker-stop-services.yaml -c paramiko --ask-pass --ask-become-pass --skip-tags exareme -vvvv
Or If you only want to stop exareme services and keep portainer running you can do so by:
ansible-playbook -i hosts.ini docker-stop-services.yaml -c paramiko --ask-pass --ask-become-pass --skip-tags portainer -vvvv
ansible-playbook -i hosts.ini docker-leave-swarm.yaml -c paramiko --ask-pass --ask-become-pass -vvvv